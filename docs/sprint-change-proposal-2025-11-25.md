# Sprint Change Proposal: Remove Viewport Lockout

**Date:** 2025-11-25
**Triggered By:** Story 2.3 (PostgreSQL Full-Text Search Backend) pre-implementation review
**Status:** Implemented
**Mode:** Incremental refinement with user approval

---

## 1. Issue Summary

**Problem Statement:** The application hard-blocked users on viewports smaller than 1280px, displaying an error page ("Desktop or Laptop Required") instead of allowing any usage. This was a terrible user experience that:

- Prevented legitimate laptop and small monitor users from accessing the app entirely
- Created user frustration instead of graceful UI adaptation
- Contradicted the UX design principle of supporting "every screen resolution gracefully"
- Blocked development testing on various screen sizes

**Issue Type:** Misunderstanding of original requirements

**Discovery:** Identified during pre-implementation review before Story 2.3. The original spec requirement for "1280px minimum" was misinterpreted as "block access below 1280px" rather than "optimize for 1280px+ with graceful degradation below."

**Evidence:**
1. `src/components/layout/ViewportCheck.tsx` enforced hard lockout at <1280px
2. ADR-010 Amendment History noted engineers use laptops (1280-1680px) for remote work
3. UX Design Specification had inconsistent guidance (lockout message vs. responsive support)

---

## 2. Impact Analysis

### Epic Impact
- **Epic 2 (current):** No structural changes needed - stories remain the same
- **All Epics (1-7):** Benefit from this fix - enables proper testing on various screens and usage during remote work
- **No new epics required** - component-level fix, not architectural shift

### Artifact Conflicts Identified

| Artifact | Conflict | Resolution |
|----------|----------|------------|
| UX Design Spec (Section 8.1) | Listed 1920px minimum with lockout message | Updated to 1024px+ graceful degradation |
| Architecture (ADR-010) | Consequences mentioned "requires desktop browser message" | Updated to "graceful degradation (no hard lockout)" |
| ViewportCheck.tsx | Blocked access on <1280px viewports | Deleted component entirely |

### PRD Impact
- **No PRD changes required** - PRD already supports responsive design
- **MVP still achievable** - this fix enables MVP better

---

## 3. Path Forward Selected

**Approach:** Direct Adjustment (Option 1)

**Rationale:**
- Minimal effort (component removal + documentation updates)
- No architectural changes required
- Aligns with existing ADR-010 intent ("graceful" support was already mentioned)
- Unblocks all users on laptops and various screen sizes
- No impact on timeline - completed quickly before Story 2.3
- Improves developer experience for testing on various devices

**Alternatives Considered:**
- Rollback: Not applicable - no completed stories needed reverting
- MVP Scope Change: Not needed - this fix enables the existing MVP scope better

---

## 4. Changes Implemented

### 4.1 UX Design Specification (`docs/ux-design-specification.md`)
**Section 8.1 - Responsive Strategy**

**Before:**
- Minimum: 1920px (1080p - baseline support)
- Mobile/Tablet: Show message "GitLab Insights requires a desktop browser (1920px minimum)"

**After:**
- Compact: 1024-1279px (graceful degradation)
- Laptop: 1280-1679px (full functionality, compact layout)
- Desktop: 1680-2559px (optimal feature visibility)
- Wide: 2560-3839px (full feature visibility with detail pane)
- Ultra-wide: 3840px+ (4K and ultra-wide)
- Mobile/Tablet: "Functional but not optimized... **No hard lockout** - users can access on any screen size"

### 4.2 Architecture Document (`docs/architecture.md`)
**ADR-010 Consequences**

**Before:**
> "mobile access shows 'requires desktop browser' message"

**After:**
> "graceful degradation on smaller viewports (no hard lockout)"

### 4.3 Code Changes

| File | Action |
|------|--------|
| `src/components/layout/ViewportCheck.tsx` | **Deleted** |
| `src/app/layout.tsx` | Removed ViewportCheck import and wrapper |

**Build Status:** ✓ Successful

---

## 5. Validation

- [x] UX Design Specification updated (Section 8.1)
- [x] Architecture Document updated (ADR-010)
- [x] ViewportCheck component removed
- [x] Layout.tsx updated to remove ViewportCheck usage
- [x] Build passes successfully
- [x] No TypeScript errors

---

## 6. Next Steps

| Action | Owner | Priority |
|--------|-------|----------|
| Proceed with Story 2.3 implementation | Dev | Immediate |
| Test app on various viewport sizes | Dev | During Story 2.3 |
| Add responsive CSS adjustments as needed | Dev | As discovered |

---

## 7. Approval

**User Approval:** Obtained during incremental review process
- Change 1 (UX Spec): Approved ✓
- Change 2 (ADR-010): Approved ✓
- Change 3 (Remove ViewportCheck): Approved ✓

---

*Generated by Correct Course Workflow - BMad Method*

---
---

# Sprint Change Proposal: Login/Onboarding Flow Improvements

**Date:** 2025-11-25
**Triggered By:** User testing feedback on Epic 1 (Walking Skeleton)
**Status:** Approved - Ready for Implementation

---

## Executive Summary

Three UX/functionality gaps were discovered in the login/onboarding flow during user testing of the completed Epic 1 Walking Skeleton:

1. **Confirm button placement** - Requires excessive scrolling on onboarding page
2. **Project selection not persisted** - Returning users have no way to modify project selections
3. **No session token refresh** - Expired sessions require manual logout/login

This proposal addresses issues 1 and 2 immediately with a new enhancement story, and defers issue 3 to Epic 6 (Reliability & Error Handling) where it fits naturally.

---

## Issue Analysis

### Issue 1: Onboarding Confirm Button Placement

| Attribute | Value |
|-----------|-------|
| **Category** | UX Issue |
| **Severity** | Medium |
| **Current Behavior** | Confirm button rendered at bottom of project list; requires scrolling past all projects |
| **Impact** | Poor UX when user has many GitLab projects |
| **Root Cause** | UI layout doesn't use sticky footer pattern |

### Issue 2: Project Selection Not Persisted for Returning Users

| Attribute | Value |
|-----------|-------|
| **Category** | Missing Feature |
| **Severity** | High |
| **Current Behavior** | After initial onboarding, there is no way to modify project selections |
| **Impact** | Users locked into initial project selections; FR83 not implemented |
| **Root Cause** | Story 1.4 only covered first-login flow; settings page deferred |

**PRD Reference:** FR83 states "Users can add/remove monitored projects from settings after onboarding" — this was documented but not implemented in MVP.

### Issue 3: No Session Token Refresh

| Attribute | Value |
|-----------|-------|
| **Category** | Technical Limitation |
| **Severity** | Medium |
| **Current Behavior** | Sessions expire after 24 hours with no refresh; users must manually logout/login |
| **Impact** | Inconvenient UX for active users |
| **Root Cause** | BetterAuth default configuration; NFR-S10 not fully implemented |

**Architecture Reference:** NFR-S10 specifies "automatic transparent refresh token rotation for active users" — not currently implemented.

---

## Recommended Path Forward

**Selected Approach:** Direct Adjustment

| Decision | Rationale |
|----------|-----------|
| Address Issues 1 & 2 now | Immediate daily UX impact; low effort |
| Defer Issue 3 to Epic 6 | Fits naturally with reliability/error handling work; not blocking |

---

## Approved Changes

### Change 1: Sticky Confirm Button (Onboarding)

**Artifact:** `src/app/onboarding/page.tsx`

**Change Description:**
- Move Confirm button and selection count to sticky footer
- Button always visible at bottom of viewport regardless of scroll position
- Apply shadow/border treatment to indicate sticky behavior

**Visual:**
```
┌─────────────────────────────────────────┐
│  Project Selection Onboarding           │
│  ─────────────────────────────────────  │
│  ☑ project-1                            │
│  ☑ project-2                            │
│  ...                                    │  ← Scrollable area
├─────────────────────────────────────────┤
│  12 of 50 selected    [Continue →]      │  ← Sticky footer
└─────────────────────────────────────────┘
```

**Effort:** Low (~1-2 hours)
**Risk:** Low

---

### Change 2: Project Settings Management (New Story)

**Artifact:** New story + new route + Header modification

**Story Definition:**

```yaml
title: "Project Settings Management"
epic: Epic 1 (Walking Skeleton) - Enhancement
story_id: 1.8
priority: High
```

**User Story:**
> As a returning user,
> I want to modify which GitLab projects I'm monitoring,
> So that I can adjust my feed without going through full onboarding again.

**Acceptance Criteria:**

1. Settings page accessible from Header dropdown menu (gear icon or "Settings" link)
2. Settings page displays "Monitored Projects" section showing current project selections
3. User can modify project selections (check/uncheck) using same UI pattern as onboarding
4. "Save Changes" button persists updated selections to MonitoredProject table
5. Success feedback shown after saving ("Projects updated successfully")
6. Settings link always accessible from app layout

**Technical Implementation:**

| Component | Approach |
|-----------|----------|
| Route | New `/settings` page |
| UI | Reuse ProjectChecklist pattern from onboarding |
| Backend | Reuse `projects.saveMonitored` tRPC mutation |
| Navigation | Add dropdown menu to Header component |
| Footer | Reuse sticky footer pattern from Change 1 |

**PRD Alignment:** Implements FR83 ("Users can add/remove monitored projects from settings after onboarding")

**Effort:** Medium (~4-6 hours)
**Risk:** Low

---

### Change 3: Session Token Refresh (Deferred)

**Artifact:** Epic 6 backlog

**Action:** Add new story to Epic 6 (Reliability & Error Handling)

**Proposed Story:**

```yaml
title: "Session Token Refresh with BetterAuth"
epic: Epic 6 (Reliability & Error Handling)
story_id: 6.x (to be assigned when epic is contexted)
priority: Medium
```

**User Story:**
> As a user with an active session approaching expiration,
> I want my session to be transparently refreshed,
> So that I don't have to manually re-authenticate during normal usage.

**Acceptance Criteria:**

1. Active sessions are refreshed automatically before expiration
2. Refresh happens transparently (no user action required)
3. If refresh fails, user sees clear message prompting re-authentication
4. Session activity extends the refresh window (sliding expiration)

**Architecture Alignment:** Implements NFR-S10 ("automatic transparent refresh token rotation")

**Deferral Rationale:**
- Fits naturally with Epic 6 reliability/error handling scope
- Not blocking daily usage (users can still re-authenticate manually)
- Allows focus on immediate UX improvements (Changes 1 & 2)

---

## Sprint Status Updates Required

### Epic 1 Updates

Add new story to Epic 1:

```yaml
# In sprint-status.yaml under Epic 1
1-8-project-settings-management: backlog
```

### Epic 6 Updates

Add new story to Epic 6:

```yaml
# In sprint-status.yaml under Epic 6
6-x-session-token-refresh: backlog
```

---

## Artifact Updates Required

| Artifact | Update Needed |
|----------|---------------|
| `docs/sprint-artifacts/sprint-status.yaml` | Add stories 1-8 and 6-x |
| `docs/epics/epic-1-walking-skeleton.md` | Add Story 1.8 to story list |
| `docs/epics/epic-6-reliability-error-handling.md` | Add session refresh story (when epic is contexted) |
| `src/app/onboarding/page.tsx` | Implement sticky footer (Change 1) |
| `src/app/settings/page.tsx` | New file (Change 2) |
| `src/components/layout/Header.tsx` | Add settings dropdown (Change 2) |

---

## Implementation Routing

| Change | Assigned To | Priority | Blocking |
|--------|-------------|----------|----------|
| Change 1: Sticky Footer | Development | High | No |
| Change 2: Settings Page | Development | High | Yes (blocks Change 1 value) |
| Change 3: Token Refresh | Backlog (Epic 6) | Medium | No |

**Recommended Implementation Order:**
1. Change 1 (Sticky Footer) - establishes pattern
2. Change 2 (Settings Page) - reuses pattern, delivers FR83

---

## Approval

| Role | Name | Date | Decision |
|------|------|------|----------|
| Product Owner | BMad | 2025-11-25 | ✅ Approved |

---

## Change Log

**2025-11-25** - Sprint Change Proposal created via correct-course workflow. Three issues identified, analyzed, and routed. Changes 1 & 2 approved for immediate implementation. Change 3 deferred to Epic 6.

---

*Generated by Correct Course Workflow - BMad Method*
